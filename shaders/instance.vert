layout (location = 0) in vec3 aPos; layout (location = 1) in vec3 aNormal; layout (location = 2) in vec2 aTex; layout (location = 3) in vec3 aTangent; layout (location = 4) in mat4 instanceMatrix; out vec3 crntPos; out vec3 viewDir; out vec3 Normal; out vec2 texCoord; out mat3 TBN; uniform mat4 camMatrix; uniform mat4 model; uniform vec3 viewPos; void main() { mat4 modelInstance = instanceMatrix; mat3 modelInstance3x3 = mat3(modelInstance); crntPos = vec3(modelInstance * vec4(aPos, 1.0)); Normal = -normalize(modelInstance3x3 * aNormal); texCoord = aTex; vec3 T = normalize(modelInstance3x3 * aTangent); vec3 B = cross(Normal, T); TBN = mat3(T, B, Normal); viewDir = normalize(viewPos - crntPos); gl_Position = camMatrix * vec4(crntPos, 1.0); }